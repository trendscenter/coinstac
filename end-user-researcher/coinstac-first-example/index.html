<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-end-user-researcher/coinstac-first-example">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">COINSTAC First Example | Coinstac</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://trenscenter.github.io/coinstac/end-user-researcher/coinstac-first-example"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="COINSTAC First Example | Coinstac"><meta data-rh="true" name="description" content="An example for beginning COINSTAC computation creators."><meta data-rh="true" property="og:description" content="An example for beginning COINSTAC computation creators."><link data-rh="true" rel="icon" href="/coinstac/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://trenscenter.github.io/coinstac/end-user-researcher/coinstac-first-example"><link data-rh="true" rel="alternate" href="https://trenscenter.github.io/coinstac/end-user-researcher/coinstac-first-example" hreflang="en"><link data-rh="true" rel="alternate" href="https://trenscenter.github.io/coinstac/end-user-researcher/coinstac-first-example" hreflang="x-default"><link rel="stylesheet" href="/coinstac/assets/css/styles.ffa15f32.css">
<link rel="preload" href="/coinstac/assets/js/runtime~main.79bb5471.js" as="script">
<link rel="preload" href="/coinstac/assets/js/main.0f452e03.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/coinstac/"><div class="navbar__logo"><img src="/coinstac/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/coinstac/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">COINSTAC documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/coinstac/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trendscenter/coinstac" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/coinstac/">COINSTAC Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/coinstac/category/researcher-end-user-documentation">Researcher end user documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Researcher end user documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coinstac/end-user-researcher/getting-started">Getting Started Using Coinstac</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coinstac/end-user-researcher/Consortium">Consortium</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/coinstac/end-user-researcher/coinstac-first-example">COINSTAC First Example</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coinstac/end-user-researcher/installing-coinstac">Installing COINSTAC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/coinstac/end-user-researcher/using-coinstac">Using COINSTAC</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/coinstac/category/computation-author-documentation">Computation author documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Computation author documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/coinstac/category/developer-documentation">Developer documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/coinstac/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/coinstac/category/researcher-end-user-documentation"><span itemprop="name">Researcher end user documentation</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">COINSTAC First Example</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>COINSTAC First Example</h1><p>An example for beginning COINSTAC computation creators.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-coinstac">Introduction to COINSTAC<a class="hash-link" href="#introduction-to-coinstac" title="Direct link to heading">​</a></h2><p><a href="https://github.com/MRN-Code/coinstac" target="_blank" rel="noopener noreferrer">COINSTAC</a> is a platform for running decentralized analyses. Users can enjoy the benefits of collaboration and data sharing while keeping their data on their own computers. The system consists of one or more client/local nodes and one remote node, which serves as an aggregator of results from the local nodes.</p><p><img loading="lazy" alt="coinstac_config.png" src="/coinstac/assets/images/coinstac_config-572e1b43ea1a090084d93762ebb6bdeb.png" width="778" height="452" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="coinstac-simulator">COINSTAC Simulator<a class="hash-link" href="#coinstac-simulator" title="Direct link to heading">​</a></h2><p>This example makes use of the <a href="https://github.com/MRN-Code/coinstac/tree/master/packages/coinstac-simulator" target="_blank" rel="noopener noreferrer">COINSTAC simulator</a>, a command-line tool that computation creators can use to test that their computations will work with COINSTAC. It provides a testing interface for computation creators without all the baggage of the full application. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-of-this-computation">Summary of This Computation<a class="hash-link" href="#summary-of-this-computation" title="Direct link to heading">​</a></h2><p>In this repo, we demonstrate a simple example of finding the average of three scalars (i.e., we are assuming three local sites). At each site, the scalar is read from a file, which is then sent to the remote/aggregator, where the average of the sites is computed and displayed.</p><p><strong>Note:</strong> The use case of reading scalars from a file has been chosen to because it is an important aspect of most computations that are written for the COINSTAC architecture.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">​</a></h2><ul><li>Latest version of <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">node.js</a><ul><li>Test 1: <code>npm -v </code></li><li>Test 2: <code>node -v </code></li></ul></li><li>Latest version of <a href="https://docs.docker.com/install/" target="_blank" rel="noopener noreferrer">docker</a><ul><li>Test: <code>docker --version</code></li></ul></li><li>Latest version of <a href="https://npm.org/packages/coinstac-simulator" target="_blank" rel="noopener noreferrer">coinstac-simulator</a><ul><li>Installation: <code>sudo npm i -g coinstac-simulator</code></li><li>Test: <code>coinstac-simulator --version</code></li></ul></li></ul><p><strong>Caveats:</strong> (Installation on Linux Distributions)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">​</a></h2><ol><li>Clone this repository:\
<code>git clone https://github.com/mrn-code/coinstac-first-example</code></li><li>Change directory:\
<code>cd coinstac-first-example</code></li><li>Build the Docker image (Docker must be running):\
<code>docker build -t avg_test .</code></li><li>Run the code:\
<code>coinstac-simulator</code></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting Started<a class="hash-link" href="#getting-started" title="Direct link to heading">​</a></h2><p>To successfully run a computation in the simulator we need to do the following:</p><ul><li><a href="#Writing-the-computation-specification">Write a compsec</a></li><li><a href="#Writing-the-input-specification">Write an inputspec</a></li><li><a href="#Writing-the-main-code">Write main code</a></li><li><a href="#Writing-the-dockerfile">Write a Dockerfile</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-the-computation-specification">Writing the Computation Specification<a class="hash-link" href="#writing-the-computation-specification" title="Direct link to heading">​</a></h3><p>The computation specification (<em><a href="https://github.com/MRN-Code/coinstac-first-example/blob/master/compspec.json" target="_blank" rel="noopener noreferrer">compspec.json</a></em>) is a JSON document detailing how the COINSTAC application interacts with the computation. This includes controlling the computation by providing necessary metadata, providing inputs, using outputs, and composing the computation with other computations.</p><p>A more thorough treatment of the computation specification can be found <a href="https://github.com/MRN-Code/coinstac/blob/master/algorithm-development/computation-specification-api.md" target="_blank" rel="noopener noreferrer">here</a>.</p><p>The computation specification for this example can be found <a href="https://github.com/MRN-Code/coinstac-first-example/blob/master/compspec.json" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-the-input-specification">Writing the Input Specification<a class="hash-link" href="#writing-the-input-specification" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="coinstac-first-example" src="/coinstac/assets/images/coinstac-first-example-bddd8cb0facfd8953c42e48794dd2952.png" width="1268" height="933" class="img_ev3q"></p><p>The input specification (<em><a href="https://github.com/MRN-Code/coinstac-first-example/blob/master/test/inputspec.json" target="_blank" rel="noopener noreferrer">inputspec.json</a></em>) is a JSON document containing the inputs that are sent to the local sites during a simulator run. The contents of <code>inputspec.json</code> for this example computation with three local sites are as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[{&quot;covariates&quot;: {&quot;value&quot;: &quot;value0.txt&quot;}},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;covariates&quot;: {&quot;value&quot;: &quot;value1.txt&quot;}},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;covariates&quot;: {&quot;value&quot;: &quot;value2.txt&quot;}}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that this is an array of size three, corresponding to three local sites. Consider the first line:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;covariates&quot;: {&quot;value&quot;: &quot;value0.txt&quot;}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This line indicates to the local.py script the file &quot;value0.txt&quot; from which the scalar is read. </p><p>When the computation begins in the simulator, the first local site receives input generated by this line.  This is in the form of an argument for the &quot;command&quot; listed in the computation specification, like so:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ python computation/local.py {&quot;input&quot;:{&quot;covariates&quot;: &quot;value0.txt&quot;}, &quot;cache&quot;: {}, state: ...}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Likewise, the second and third local sites receive covariates from the corresponding elements from the array in the input specification (containing &quot;value1.txt&quot; and &quot;value2.txt&quot;, respectively). </p><p><strong>NOTE:</strong> Notice the presence of “value” key in inputspec.json. When this input is provided to the local function, you can see that the “value” key is not used. This is a convention used by the COINSTAC application.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-the-main-code">Writing the Main Code<a class="hash-link" href="#writing-the-main-code" title="Direct link to heading">​</a></h3><p>To create a computation for COINSTAC, you must write code that is executed on the local and remote nodes. This code can be written in any programming language, but Python is the most common language used. For a computation written in Python, the code that is to be run on a local site is called local.py, and the code that is to be run on the remote site is called remote.py. This is by convention; any names can be used as long as they are listed in the computation specification under &quot;command.&quot; Note the use of  <code>python /computation/local.py</code> and <code>python /computation/remote.py</code> in <a href="https://github.com/MRN-Code/coinstac-first-example/blob/master/compspec.json" target="_blank" rel="noopener noreferrer">compspec.json</a>.</p><p>The current COINSTAC architecture assumes that all computations start at the local node.  COINSTAC simulator is a sequence of python calls to local.py and remote.py with the output of one function call fed as an input to the next function call in the form of a command-line arguments.</p><p>The application communicates with the computation via standard input (<code>stdin</code>) and standard output (<code>stdout</code>). Note that these are used for I/O in <a href="https://github.com/MRN-Code/coinstac-first-example/blob/master/local.py" target="_blank" rel="noopener noreferrer">local.py</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-the-dockerfile">Writing the Dockerfile<a class="hash-link" href="#writing-the-dockerfile" title="Direct link to heading">​</a></h3><p>To run your computation in COINSTAC, you&#x27;ll need to encapsulate it in a docker image. For now, we have one base Python 3.6 image that all computations must inherit from. The Dockerfile uses that image as a base, places your code into the /computation folder, and performs installation of dependencies required by your code, as specified in requirements.txt</p><p><strong>Note</strong>: Please ignore any test or extraneous files by using a <a href="https://docs.docker.com/engine/reference/builder/#dockerignore-file" target="_blank" rel="noopener noreferrer">.dockerignore</a> file. This keeps the image small, which improves the performance of the build.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># python version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM python:3.7.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set the working directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /computation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the current directory contents into the container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY requirements.txt /computation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install any needed packages specified in requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN pip install -r requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the current directory contents into the container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY . /computation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Explanation of Dockerfile Contents:</strong></p><ul><li><code>FROM python:3.7.8</code><ul><li>This establishes that the computation is running python code and sets the working version</li></ul></li><li><code>WORKDIR /computation</code><ul><li>This is the working directory where your computation scripts are called.</li></ul></li><li><strong>need to explain the other lines in the code but have to test something before I do that</strong></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-test-data">Setting up the Test Data<a class="hash-link" href="#setting-up-the-test-data" title="Direct link to heading">​</a></h3><p>In order to successfully test a computation in the coinstac-simulator application, you must create a test folder that contains the input specification and test data for each local site.</p><p>One quick look at the structure of the current computation using the <code>tree</code> command will yield the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── ancillary.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── compspec.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── local.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── remote.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── inputspec.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── local0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── simulatorRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       └── value0.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── local1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── simulatorRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       └── value1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── local2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── simulatorRun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └── value2.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice the presence of <code>test/local#/simulatorRun/value#.txt</code>. The computation author should manually create a <code>local#/simulatorRun</code> inside the <code>test</code> directory for each local client.</p><p> <strong>Note:</strong> By now, you should realize that the number of folders you create should match the array size as specified inputspec.json. The contents therein can be accessed only from that particular client and no one else.</p><p>Folders named <code>cache</code>, <code>output</code> and <code>remote</code> will be created at when the computation in run with coinstac-simulator as well.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="behind-the-scenes">Behind the Scenes<a class="hash-link" href="#behind-the-scenes" title="Direct link to heading">​</a></h2><ul><li>In the current scenario, the output from local.py at local client will look as follows:<ul><li>At client 1: \
<code>{
       &quot;output&quot;: {
           &quot;output_val&quot;: 5,
           &quot;computation_phase&quot;: &#x27;local_1&#x27;
       }
   }</code></li><li>At client 2: \
<code>{
       &quot;output&quot;: {
           &quot;output_val&quot;: 5,
           &quot;computation_phase&quot;: &#x27;local_1&#x27;
       }
   }</code></li><li>At client 3: \
<code>{
       &quot;output&quot;: {
           &quot;output_val&quot;: 5,
           &quot;computation_phase&quot;: &#x27;local_1&#x27;
       }
   }</code></li></ul></li></ul><ul><li>The input at remote.py, which is an aggregation of outputs from all the local clients, will look as follows:
<code>{&#x27;input&#x27;: {&#x27;local0&#x27;: {&#x27;output_val&#x27;: [5], &#x27;computation_phase&#x27;: &#x27;local_1&#x27;}, &#x27;local1&#x27;: {&#x27;output_val&#x27;: [6], &#x27;computation_phase&#x27;: &#x27;local_1&#x27;}, &#x27;local2&#x27;: {&#x27;output_val&#x27;: [7], &#x27;computation_phase&#x27;: &#x27;local_1&#x27;}}, &#x27;cache&#x27;: {}, &#x27;state&#x27;: ....</code><ul><li>Note, how the outputs from each local client are wrapped into a dictionary with the client ID being the key and sent in as an input to the remote node.</li></ul></li></ul><ul><li><p>Without getting into the details, we point the reader/computation author to the use of the function <code>list_recursive</code> from <a href="https://github.com/MRN-Code/coinstac-first-example/blob/master/ancillary.py" target="_blank" rel="noopener noreferrer">ancillary.py</a> to determine the next function that should be invoked at the local/remote node having previously returned from a remote/local node.</p></li><li><p>Also, notice the use of <code>args[&quot;state&quot;][&quot;baseDirectory&quot;]</code>, which points to <code>test/local#/simulatorRun</code>.</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/trendscenter/coinstac/tree/master/coinstac-docs/docs/end-user-researcher/coinstac-first-example.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/coinstac/end-user-researcher/Consortium"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Consortium</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/coinstac/end-user-researcher/installing-coinstac"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Installing COINSTAC</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction-to-coinstac" class="table-of-contents__link toc-highlight">Introduction to COINSTAC</a></li><li><a href="#coinstac-simulator" class="table-of-contents__link toc-highlight">COINSTAC Simulator</a></li><li><a href="#summary-of-this-computation" class="table-of-contents__link toc-highlight">Summary of This Computation</a></li><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting Started</a><ul><li><a href="#writing-the-computation-specification" class="table-of-contents__link toc-highlight">Writing the Computation Specification</a></li><li><a href="#writing-the-input-specification" class="table-of-contents__link toc-highlight">Writing the Input Specification</a></li><li><a href="#writing-the-main-code" class="table-of-contents__link toc-highlight">Writing the Main Code</a></li><li><a href="#writing-the-dockerfile" class="table-of-contents__link toc-highlight">Writing the Dockerfile</a></li><li><a href="#setting-up-the-test-data" class="table-of-contents__link toc-highlight">Setting up the Test Data</a></li></ul></li><li><a href="#behind-the-scenes" class="table-of-contents__link toc-highlight">Behind the Scenes</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/coinstac/">Coinstac Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/trendscenter/coinstac/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://trendscenter.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TReNDS Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 TReNDS Center</div></div></div></footer></div>
<script src="/coinstac/assets/js/runtime~main.79bb5471.js"></script>
<script src="/coinstac/assets/js/main.0f452e03.js"></script>
</body>
</html>